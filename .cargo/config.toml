# Author: Lukas Bower
[env]
# APFS and iCloud-attached volumes on macOS 26 occasionally reap the
# temporary directories that rustc creates for incremental compilation.
# When that happens, rustc emits "No such file or directory" errors while
# writing rmeta artefacts (e.g. zerocopy, serde) under `target/debug/deps`,
# matching the failures reported by local builds. Disabling incremental
# globally keeps the build reliable across all crates, including registry
# dependencies that were still opting into incremental compilation even after
# the per-package overrides below. A lightweight rustc wrapper (see
# `scripts/rustc-wrapper.sh`) now pre-creates the relevant output directories
# before each invocation so that dep-info writes do not fail even if APFS
# aggressively trims empty folders mid-build.
CARGO_INCREMENTAL = "0"

[build]
rustc-wrapper = "scripts/rustc-wrapper.sh"

[profile.dev.package.root-task]
incremental = false

[profile.release.package.root-task]
incremental = false
opt-level = "s"
codegen-units = 1
strip = "symbols"

[profile.dev.package.nine-door]
incremental = false

[profile.release.package.nine-door]
incremental = false

[profile.dev.package.worker-heart]
incremental = false

[profile.release.package.worker-heart]
incremental = false

[profile.dev.package.worker-gpu]
incremental = false

[profile.release.package.worker-gpu]
incremental = false

[target.aarch64-unknown-none]
rustflags = [
    "-C",
    "relocation-model=static",
    "-C",
    "code-model=large",
]
